!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("bvtnet-items-provider",[],t):"object"==typeof exports?exports["bvtnet-items-provider"]=t():e["bvtnet-items-provider"]=t()}(self,(function(){return(()=>{"use strict";var e={d:(t,r)=>{for(var o in r)e.o(r,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:r[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};function r(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function o(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?r(Object(o),!0).forEach((function(t){n(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function s(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}e.r(t),e.d(t,{default:()=>f});var i=new WeakMap,l=new WeakMap,c=new WeakMap,u=function(){function e(t){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.init(t)}var t,r,n;return t=e,r=[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this,r=e.fields||[],o=e.axios,n={},a=r.constructor===Array||Array.isArray(r);if(i.set(t,"ItemsProvider"),l.set(t,o),t.stateId=e.stateId,t.state=n,t.fields=r,t.busy=!1,t.storage=e.storage||window.localStorage,t.pageLengths=[{value:15,text:"15"},{value:100,text:"100"},{value:500,text:"500"},{value:1e3,text:"1000"},{value:-1,text:"All"}],t.resetCounterVars(),n.perPage=e.perPage||15,n.currentPage=e.currentPage||1,n.filter=e.filter,n.filterIgnoredFields=e.filterIgnoredFields||[],n.filterIncludedFields=e.filterIncludedFields||[],n.searchFields=e.searchFields||{},n.sortFields=e.sortFields||{},n.query=e.query||{},n.queryUrl=e.queryUrl,!a){t.fields=[];var s=["onFieldTranslate","searchable","isLocal","key","label","headerTitle","headerAbbr","class","formatter","sortable","sortDirection","sortByFormatted","filterByFormatted","tdClass","thClass","thStyle","variant","tdAttr","thAttr","isRowHeader","stickyColumn","data","name"];for(var c in r){var u=r[c],f={};u.key="".concat(u.key||u.name||u.data||c),u.isLocal&&(u.searchable=!1,u.sortable=!1,delete u.filterByFormatted);for(var d=0;d<s.length;d++)u.hasOwnProperty(s[d])&&(f[s[d]]=u[s[d]]);t.fields.push(f)}}if(t.items=function(e,r){return t.executeQuery(e,r,this)},"string"==typeof t.stateId){"function"==typeof t.onStateLoading&&t.onStateLoading();var y=t.storage.getItem(t.getStateId());if("string"==typeof y&&y.indexOf("}")>0){var p=JSON.parse(y);for(var v in p)t.state[v]=p[v];"function"==typeof t.onStateLoaded&&t.onStateLoaded(p)}}return t}},{key:"resetCounterVars",value:function(){var e=this;e.totalRows=e.recordsTotal=e.startRow=e.endRow=0}},{key:"getName",value:function(){return i.get(this)}},{key:"getAxios",value:function(){return l.get(this)}},{key:"getLocalItems",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=c.get(this);return t&&e&&e(t),t}},{key:"setLocalItems",value:function(e){var t=this;t.state.currentPage=1,t.totalRows=e?e.length:0,t.recordsTotal=t.totalRows,t.startRow=t.totalRows>0?1:0,t.endRow=t.totalRows,t.state.perPage=-1,c.set(this,e)}},{key:"decode",value:function(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(t){return e}}},{key:"encode",value:function(e){try{return encodeURIComponent(e)}catch(t){return e}}},{key:"queryParseString",value:function(e){e=(e||"").replace("?","").replace("#","");for(var t=/(\w+)\[(\d+)\]/,r=this.decode,o={},n=e.split("&"),a=0;a<n.length;a++){var s=n[a].split("="),i=r(s[0]),l=t.exec(i);l?(o[l[1]]=o[l[1]]||[],o[l[1]][l[2]]=r(s[1])):o[s[0]]=r(s[1]||"")}return o}},{key:"queryStringify",value:function(e,t){var r,o=this.encode,n=[];for(r in e)if(e.hasOwnProperty(r)){var s=t?t+"["+r+"]":r,i=e[r];n.push(null!==i&&"object"===a(i)?this.queryStringify(i,s):o(s)+"="+o(i))}return n.join("&")}},{key:"translateContext",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this,n=r.fields,s=r.state,i=s.extraQuery||{},l=o(o({draw:1,start:(e.currentPage-1)*e.perPage,length:e.perPage,search:{value:"".concat(e.filter||"")},order:[],columns:[]},i),t);e.filter instanceof RegExp?(l.search.regex=!0,l.search.value=e.filter.source):"string"!=typeof e.filter&&(l.search.value="");for(var c=-1,u=0;u<n.length;u++){var f=n[u];"string"==typeof f&&(f={key:f});var d={data:f.data||f.key,name:f.name||f.key,searchable:void 0===f.searchable||f.searchable,orderable:void 0===f.sortable||f.sortable};if(s.filterIgnoredFields&&s.filterIgnoredFields.indexOf(f.key)>-1&&(d.searchable=!1),s.filterIncludedFields&&s.filterIncludedFields.indexOf(f.key)>-1&&(d.searchable=!0),"function"==typeof r.onFieldTranslate&&r.onFieldTranslate(f,d),!f.isLocal&&""!=="".concat(f.key)){if(l.columns.push(d),c++,d.orderable&&e.sortBy===f.key&&l.order.push({column:c,dir:e.sortDesc?"desc":"asc"}),d.searchable&&s.searchFields){var y=s.searchFields[f.key];null!=y&&("boolean"==typeof y.regex?d.search=y:y instanceof RegExp?d.search={value:y.source,regex:!0}:"object"===a(y)||Array.isArray(y)||(d.search={value:"".concat(y||""),regex:!1}))}if(d.orderable&&s.sortFields){var p=s.sortFields[f.key];"asc"!==p&&"desc"!==p||l.order.push({column:c,dir:p})}}}return l.columns.length<=0&&delete l.columns,l}},{key:"getStateId",value:function(){return"bvtnetip.".concat(this.stateId)}},{key:"performSaveState",value:function(){var e=this;return"string"!=typeof e.stateId||("function"==typeof e.onStateSaving&&e.onStateSaving(),e.storage.setItem(e.getStateId(),JSON.stringify(e.state)),"function"==typeof e.onStateSaved&&e.onStateSaved()),e}},{key:"executeQuery",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=this,o=r.getLocalItems(t),n=(e.apiUrl||r.apiUrl).split("?"),a={};if(n.length>1&&(a=r.queryParseString(n[1])),a=r.translateContext(e,a),"function"==typeof r.onBeforeQuery&&r.onBeforeQuery(a,e),r.state.queryUrl=n[0],r.state.query=a,o)return o;r.resetCounterVars(),r.busy=!0;var s=r.getAxios(),i=r.state.queryUrl,l="POST"===r.method?s.post(i,a):s.get("".concat(i,"?").concat(r.queryStringify(a)));return l.then((function(e){var t=e.data;return r.totalRows=t.recordsFiltered,r.startRow=r.totalRows>0?a.start+1:0,r.endRow=a.start+a.length,r.recordsTotal=t.recordsTotal,r.endRow>r.totalRows&&(r.endRow=r.totalRows),"function"==typeof r.onResponseComplete&&r.onResponseComplete(e),r.busy=!1,r.performSaveState(),t.data||[]})).catch((function(e){return r.busy=!1,"function"==typeof r.onResponseError&&r.onResponseError(e),[]}))}}],r&&s(t.prototype,r),n&&s(t,n),e}();const f=u;return t=t.default})()}));
